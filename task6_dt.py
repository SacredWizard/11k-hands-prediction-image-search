import pdb
import os
import sys

sys.path.append(os.path.split(sys.path[0])[0])
from classes.dimensionreduction import DimensionReduction
from utils.model import Model
import utils.relevancefeedback as relevancefeedback
import numpy as np
import random as random
import operator
import utils.imageviewer as imgvwr
import phase2.task1 as p1task1
import phase2.task1 as p2task1
import phase3.task1 as p3task1
import time
import warnings
from task4_svm import SupportVectorMachine, gaussian_kernel
from sklearn.neighbors import KNeighborsClassifier
from sklearn.tree import DecisionTreeClassifier

warnings.filterwarnings("ignore")

from flask import Flask, request, render_template, send_from_directory, url_for

app = Flask(__name__)

model_interact = Model()

"""
Dummy. TO be replaced by actual LSH method
"""


def search_LSH(query_image):
    fea_ext_mod = "LBP"
    dim_red_mod = "LDA"
    dist_func = "euclidean"
    k_value = 30
    t_value = 20
    training_set = os.path.abspath('Dataset3/Labelled/Set2')
    test_set = os.path.abspath('Dataset3/Unlabelled/Set 1')
    dim_reduction = DimensionReduction(fea_ext_mod, dim_red_mod, k_value)

    filename = "{0}_{1}_{2}_{3}".format(fea_ext_mod, dim_red_mod, str(k_value), os.path.basename(training_set))
    model = model_interact.load_model(filename=filename)
    if model is None:
        p2task1.save_model(dim_reduction, fea_ext_mod, dim_red_mod, str(k_value), folder=os.path.basename(training_set))
        model = model_interact.load_model(filename=filename)
    results = dim_reduction.find_m_similar_images(model, t_value, training_set, query_image, dist_func)
    return results


"""
Method to incorporate relevance feedback
"""


def rewrite_query(feedback):
    # pdb.set_trace()
    global feedback_imgs_g, feedback_vals_g, similar_images_g, similar_image_vectors_g

    feedback = {'Hand_0000072.jpg': '1', 'Hand_0000073.jpg': '-1', 'Hand_0000074.jpg': '1', 'Hand_0000112.jpg': '-1'}
    x_train = [[-0.29024992239957165, -0.5268297932816942, -0.1778647052439814, -0.3415667436753882, -0.358686084579328,
                -0.4053489691401993, -0.10574918523570886, -0.3887837669119775, -0.3241668367276715,
                -0.05468358723918253, -0.09720365010875603, -0.28564017995738705, -0.1921681057201325,
                0.16428883372471362, 0.8538413898275095, -0.29825691807772203, -0.28645007999808253, 3.869859706405068,
                -0.2630161670730121, -0.30541459820943867, 2.744861748709603, -0.213765110397644, -0.2957226436126408,
                1.8629652455708965, -0.31069046582752646, -0.36098151187541216, -0.4460098752258481,
                -0.3921555529978921, -0.2449499557393356, -0.0037081290632661646],
               [-0.2686409702149302, -0.45360703949393527, -0.3790082255798626, -0.5133897677058874, -0.382560677560544,
                -0.3757567699907057, -0.19333279892220423, 0.08450701290523563, -0.3263844059228344, 1.8558942920649384,
                0.42295670174567956, 0.48727058576979515, -0.3020007898627517, -0.3483638260398555,
                -0.07078755339922065, 1.7445981619639617, 0.13673112583292335, -0.03951308222176184,
                0.07419482886676178, -0.25106793228007535, -0.3781737124040584, -0.155722884861101, -0.2592814332688672,
                -0.3496857539850073, 1.8211127346079394, -0.3286237401114738, -0.2426146864100257, -0.3367309663081931,
                0.017295502596430288, 0.15384531829911105],
               [-0.29894504249474946, -0.5658206152787244, -0.3957094169965892, -0.6156033013173654,
                -0.43546316849799477, -0.38468251327158215, -0.20142346879328807, -0.3222735768270717,
                -0.3583193977601217, -0.8372571311207483, -0.2700251860484142, -0.30472287132687204,
                -0.5034615464576966, -0.7686006922885014, -0.3202825203893024, -0.30054765143187334,
                -0.2894153518099985, -0.6489202949103932, -0.6018358860585507, -0.3112168632110809,
                -0.41905027986000914, -0.2660561892459791, -0.4217287142700236, -0.37352408725533986,
                -0.30429348611689017, 5.564469539330134, -0.5030825394139452, -0.3911735589207477, -0.31767747454454304,
                -0.8134889063729851],
               [0.3696418092188237, 0.5395830224462396, 0.8985784614180374, 1.377155002617043, 0.4409756617823712,
                -0.3958854350867763, -0.1984978987156803, -0.4525680192009031, -0.3363054435711384, 0.3526824523480272,
                -0.2565397543307279, -0.2915705163891125, -0.15313380541736474, 0.6882808811031833, -0.2698698589806506,
                -0.29988149062390906, -0.2828809886448936, -0.04152313858314087, -0.5845395507949471,
                0.002873320815885746, -0.4096531465429925, -0.0610198069252163, -0.3631639244019959,
                -0.3336217743314878, -0.33916119476971784, -0.3602691599077199, 0.12046064717842457, 2.723842055507219,
                -0.3132262819916682, -0.7133600406107785],
               [-0.29750686129948883, -0.5630173832771919, -0.39323799007981797, -0.5959698549635412,
                -0.43110101752674496, 1.1343452046049134, -0.20143718447194342, -0.18366715014646456,
                -0.35878410687347817, -0.6846644575730326, -0.21422983154002218, -0.30147218025949246,
                -0.4698639829353562, -0.45538136490793685, -0.26047038762902236, -0.28302868390141533,
                -0.2834543474572973, -0.6206720814656804, 0.4211797326087129, -0.30932469677721913, 3.4966660141500125,
                -0.23017088927144247, -0.3795364717940973, -0.37393288625851834, -0.2962213744952113, 1.056524886489939,
                -0.49765356931090676, -0.37289363648630913, -0.3168199692503475, -0.23020547418354087],
               [-0.28873602241758634, -0.4937296146498963, -0.370282416273848, -0.49827016357656173, 2.8631021773910557,
                -0.40602593245354446, -0.007429574020308723, -0.05248219553586307, -0.33285642734484167,
                -0.4467573825093117, 0.029871533858467258, -0.27261799483713595, 0.8600314471286004, 0.9522549442496624,
                -0.26012672348740956, -0.2995793312239746, -0.28892737324985884, 4.884976095487779, -0.4592342160266727,
                -0.26111808823666127, 0.4450702153525478, -0.25998702997540524, -0.06473274789881366, 1.351852067563098,
                -0.33991874758994345, -0.34115100083647776, -0.010743281601546454, -0.37788878784884616,
                0.0005305199556388171, -0.3247004320425066],
               [0.4555539058002584, 2.1241319916034276, 0.05474844089646811, 2.8755626924778364, 1.1701765969905296,
                -0.4044989778540806, -0.1994891465579452, -0.47350164753328317, -0.33161153639263385,
                -0.20449767727207788, -0.2622416551428124, -0.28994203171788957, 0.13001573366467803,
                0.37594221828396857, -0.2849039043931675, -0.30244672241431203, -0.27928588142751626,
                0.6774474971351886, -0.5981044934980317, 0.34399212679161045, -0.4202830128228865,
                -0.056859856269969374, -0.31725078988461186, -0.32719874173818786, -0.35061192901553373,
                -0.36250603928374725, 1.8721366943616824, 0.53387886938187, -0.3121293373459399, -0.7237898286424298],
               [-0.11403165614391415, -0.555053433643125, -0.37562273704488447, -0.511072857357034, -0.424983172358198,
                -0.4061536507743879, -0.18601453173306154, -0.46266867837072967, -0.3495659304832927,
                -0.7745715677926999, -0.2744080193109681, -0.30427216779176336, -0.3973374882750374,
                -0.7240446730188704, 0.9422350800756825, -0.2844134547352221, -0.2895165758354855, -0.21000019138243337,
                -0.553657565329304, -0.2851801926494785, -0.3680005119025247, 6.635325732035591, -0.3896500266482375,
                -0.36804503637371566, -0.3484114645331151, -0.36242612041050565, -0.5037412055570074,
                -0.3885225857680557, -0.19672040514200864, -0.6658866424354151],
               [-0.29315534935896204, -0.029758512453170762, -0.3148582027290683, -0.00756341839715315,
                -0.4057374747407331, -0.40576541493188883, -0.060894329329444614, -0.1919190814764307,
                -0.16103538203620826, -0.3678381723842736, -0.2671320072777256, -0.22137470610521146,
                -0.12079449755636762, -0.104629464533344, -0.3069034759090374, -0.30143656190483636,
                -0.2895883389693907, -0.5478439277022604, -0.04201412301690219, 5.408859918133071, -0.40330484885401496,
                -0.24180074692826908, 0.2583513017059153, -0.37294235109013507, -0.26992829573909943,
                -0.1268923485312721, -0.459674316602517, -0.39307604534405916, -0.1402817238040893,
                0.39364897765385026],
               [-0.29971539818335513, -0.5392311150163429, -0.3702817471179274, -0.4934917441563638,
                -0.4296949280898903, 3.3887513806363136, -0.11728792556005642, -0.41784532392241214,
                -0.3444678933974881, -0.6821390701798198, -0.24945995169465998, -0.28627153325961663,
                -0.19452990193084793, -0.3284876545488061, -0.3020813227271121, -0.17671516888747407,
                1.3676356179738525, -0.3622328972405432, -0.10543015193469156, -0.300593387390462, -0.3866788766629483,
                -0.2343753191295572, -0.28192978094503246, -0.36372922114840056, -0.3514252880552011,
                -0.3623307871343615, -0.49252152442686037, -0.38166208567188253, -0.25188238144650044,
                -0.51847438006255],
               [-0.29588093802227516, -0.35781478491253543, -0.3158416421062962, -0.43895702395367125,
                3.817207663238055, -0.4057007329252386, 0.10883756241568149, -0.09259654915996576, -0.2956946337424276,
                0.045956489078636205, 0.4206323002356738, -0.2506890317247254, 1.9376110665253266, 0.7557553520349151,
                -0.30657240873550234, -0.30152456941287364, -0.28881941379893644, 0.8083978910431264,
                -0.403846708025381, -0.2674022970413181, -0.27833026543792955, -0.2608663790822843,
                -0.19296616318024212, 0.09199881044713468, -0.18855348813995818, -0.22742126841876417,
                2.6697475756101436, -0.3841727612388606, -0.10109110630665782, 0.046590281490815254],
               [-0.29027422335763764, 0.1464025814281257, -0.34790274925829767, -0.037906602152141415,
                2.2206481236041644, -0.40545830396627774, 0.2865095776173748, 1.421948995512194, -0.20024473193625414,
                0.5419098478152308, -0.19036907192089972, -0.27405754979251057, 1.275179917053158, 0.9174884730091809,
                -0.24417527034238784, -0.29356540106460943, -0.28934504905249286, 2.2928485898077087,
                -0.2960334103479842, -0.04349683165334658, -0.039575781332994206, -0.23084770620304573,
                0.08259786154284487, -0.3112148071381678, -0.11734684298041842, -0.118975586747679, 0.24181343680136433,
                -0.39138315070316415, 0.2880286520819572, 0.6481355571258791],
               [-0.2727943820776479, -0.5274546397720122, -0.38434695339253905, -0.5379956819111713,
                -0.40877416136403444, 2.277571401614307, -0.20122342152723757, 2.8170078839453394, -0.35667731819987886,
                -0.3239303760153204, -0.16134946988348822, -0.29314996341513366, -0.4545851917317616,
                -0.11074018199551407, -0.08177452373709045, -0.21874558797740074, -0.27844146594715746,
                -0.45089802931184614, -0.2104979692426702, -0.29433205561024534, -0.15064637765766886,
                -0.19488212531314042, -0.381327331468326, -0.37082556397257915, -0.07751681321837371,
                0.5321885284188397, -0.4603771657972167, -0.3060471428891817, -0.30307746594791846,
                -0.27166701434172985],
               [-0.2959322529110761, -0.559351605264856, -0.3917071986383799, -0.5958166457126068, -0.43263586962741685,
                1.0517559941975039, -0.2008425521435785, 0.3103695768196663, -0.3577035476923789, -0.6962480932322747,
                -0.16586129557270865, -0.3023506996843083, -0.4459295361996255, -0.09067760277879754,
                -0.15711834360811905, -0.28736182377405445, -0.28290618190265165, -0.6004720522782573,
                0.08167155537075321, -0.3088029575842451, 3.1543167733264585, -0.2239870527095143, -0.37109273792243863,
                -0.3732775705192511, -0.3005754529566369, 1.065351178421097, -0.4943631911429805, -0.3640173039339314,
                -0.3155936572166648, 0.14171341307343938],
               [-0.28544593361643994, -0.5340221729568654, -0.38535863135133847, -0.5570908870230489,
                -0.42165891593646376, 2.679510824086486, -0.20109035133788228, 0.4418699703812747, -0.3573985692777378,
                -0.5164006364738144, -0.1954986545796629, -0.2959753527705158, -0.3839999086617466, -0.3925239981156223,
                -0.19070926653715153, -0.2618835027907806, -0.26665225827586697, -0.46414126537754846,
                0.0738532534807072, -0.30041354112791135, 0.5816369754985851, -0.18932670627321285,
                -0.31672598576343297, -0.3718068313928771, -0.19447626242024396, 0.6556737507704018,
                -0.46089074449353784, -0.3375128666284005, -0.3069606423439661, -0.11835358763580106],
               [-0.25801043329480844, -0.332106435509015, -0.3658944284877824, -0.40003118387830644,
                -0.3255715166270165, -0.3502791153560001, -0.19784046556543705, -0.1357682981674642,
                -0.27347390898560664, -0.004394930217482051, 0.478539592565487, -0.1550640663663007, -0.193881203730755,
                -0.3202263543707347, -0.10938074923082429, 0.10546815850760352, 0.03789843954298887,
                0.36849344271646256, 0.1650033175756169, -0.2275084608801275, -0.19931166737535672,
                -0.15313407335997084, -0.1221764225694283, -0.33728304014329114, -0.18751555482275498,
                -0.32537763206265613, 0.24128201447042105, -0.31672150336769866, 3.902201898186104, 0.4591538850764959],
               [-0.2995703080992267, 0.5701879900601792, -0.12020406507425607, 1.2117776494062829, -0.40852370800109383,
                -0.4034623978997481, 0.6037780485173232, 0.436815043177539, 0.5834007966734921, 1.6037108925043313,
                -0.181187251732907, 0.08429480745331522, -0.15953767493749987, 2.3922634393517823, -0.30819549230100557,
                -0.30274643261199347, -0.2888703389059484, -0.4282963861488752, 2.2470325073871074,
                -0.07731616189204446, -0.35246471960114834, -0.2384772360819038, 2.3819349008362862,
                -0.3540559284629322, -0.24542590778889975, -0.3154441620159837, -0.32664277876996567,
                -0.3934486776048919, -0.2360948060858081, 1.5823394290294743],
               [-0.27222434676246365, -0.5200722913946224, -0.37729447754728646, -0.5231135484299373,
                -0.41720529843001714, 1.6857795668748015, -0.20066578668970023, 5.077307624018339, -0.3501611488100168,
                -0.20584655012322936, -0.027744771405880178, -0.29640327366901953, -0.42816894465667027,
                0.8427881409477364, 0.3044713100511304, -0.1900928072872325, -0.2813024748419604, -0.45021346629750164,
                -0.3060654292329171, -0.2912299510830798, -0.03811619484485335, -0.18075755694982426,
                -0.3765197377392897, -0.3653309948350862, -0.2036110585688033, -0.15508464077065393,
                -0.46229822534688586, -0.2872517917765062, -0.31061738846977166, 0.18510829685805252],
               [-0.22326160915099835, -0.5637381877904785, -0.39251929123793106, -0.5919728399260853,
                -0.4327739038335499, -0.4023564249041773, -0.19716801569630119, -0.4783654818201939,
                -0.35739484714813896, -0.83877435650766, -0.24810076752687088, -0.3051088866082297, -0.4265120510601995,
                -0.7693124590438907, -0.24949221223563842, 5.684142962942762, -0.24427037097534388,
                -0.12427388044871837, -0.595377297073812, -0.31036973448032495, -0.41806704607746503,
                -0.25531140049175105, -0.4101798225784954, -0.3089848724589069, -0.35561031138790117,
                -0.36291609458365887, -0.5031675641860103, 0.6701942026055553, -0.25980188081462724,
                -0.7748892458694723],
               [-0.2999265811950286, -0.44025241472848026, -0.2716665114494909, -0.41584440385152527,
                -0.4270737761088438, -0.39736005759808357, -0.14480371037590875, -0.3307537587690584,
                -0.24390155824397755, 0.5343602388091974, -0.25476113198258715, 4.980688934762398, -0.4817321157965116,
                -0.4621533382702782, -0.32790361702402687, -0.30370393791623645, -0.28937613561663533,
                -0.6285728368967389, -0.15388516774042263, -0.2815614923123264, -0.4126839271774774,
                -0.26094062883290314, -0.31590558425399323, -0.3661561437560899, 0.13960363964064879,
                -0.312565162582328, -0.12308514644030853, -0.3935292459803578, -0.31144832529481414,
                -0.4587766021317351],
               [-0.27572065857550687, -0.5497892689773994, -0.3907007660197585, -0.5756235885030949,
                -0.4262928782373622, -0.37580386015173706, -0.1918614190766258, -0.4728755045068076,
                -0.35515449049642833, -0.8265851766989923, -0.26683406140522437, -0.30496680525851755,
                -0.16645792541772486, -0.7506048833745822, -0.2956948068879886, 5.291129571784338, -0.2307598569205886,
                -0.1538496107189353, -0.5823190870010833, -0.3013800226555384, -0.4261251416120874,
                -0.24802472200112713, -0.4012118514463514, -0.36792103246648816, -0.35313387868813734,
                -0.3616771460024383, -0.5013293271867993, 1.057596074770365, -0.05747507588254981, -0.6916881507830965],
               [3.5864082317716806, 4.18853872943939, -0.355501828534252, -0.04746031858483478, 0.025058627966536892,
                -0.40403467657435826, -0.19844792532112793, -0.4682509032845852, -0.30685619865088193,
                -0.6124612874440108, -0.26771220374866384, -0.3015668786711093, -0.44898420608178086,
                -0.48528445609625975, -0.2957315944661966, -0.30197707821420683, -0.28793506084495407,
                -0.424392994521819, -0.6064965631329714, 0.36258726646622347, -0.4276437307594547, -0.22596237519237522,
                -0.4116240092331678, 0.02721315117719071, -0.34831256871759075, -0.362031369368113, -0.2467280452660435,
                -0.2808054525355522, -0.3173496715556351, -0.8118339216462429],
               [-0.29646840623203774, -0.5600533092997927, -0.3926441208142193, -0.5859447140677939,
                -0.42613550583538146, 2.4172618229524736, -0.20143038485759743, -0.044313390611455186,
                -0.35878787891621405, -0.7058654468305561, -0.23706321129291708, -0.3000311127716173,
                -0.4522714060885038, -0.5284391500737375, -0.2749983344633193, -0.28602672983060073, -0.280258752125118,
                -0.5852404999674031, -0.016949674214882228, -0.3075771355047802, 1.1587892979467265,
                -0.2307491832741395, -0.355452391974597, -0.3738546528918189, -0.2828347587670491, 1.1423197194609738,
                -0.49023513887663056, -0.3705030876560538, -0.31414016259007543, -0.34887475978944127],
               [-0.2964953866600837, 0.33594128589795774, -0.35208385646803625, -0.36205628551246827,
                -0.23793318112014658, -0.40319964835718053, -0.030130532952179875, 0.4115468804495345,
                -0.07560152977979652, 0.5132177576128377, -0.2214136000518344, -0.0810932878144101,
                -0.14663693779532902, -0.19631785076212147, -0.31123300011766897, -0.30134337063606276,
                -0.2894080019046282, -0.4958587731968984, -0.3530667167403431, 0.4612162871399666, -0.3583087532356393,
                -0.2506482750644551, -0.1262498894702553, -0.3687814858335814, 0.3736281966269415, 2.3841526641365096,
                1.0270311249941595, -0.39299449268712844, -0.25742438635118925, -0.02204260800299169],
               [-0.11718821946360042, -0.5548085370230533, -0.38915497175213676, -0.5931094517391126,
                -0.4180557252863752, -0.40174740029376416, -0.1946427767792784, -0.47487227482807354,
                -0.3570585187982272, -0.8462837489575183, -0.2711113103650255, -0.3051934460078169,
                0.023354064345855734, -0.7527546915655926, -0.2110122904917672, 4.1393987009457875,
                -0.28059462471745755, -0.1712081615733669, -0.5912955448883386, -0.2672263634016837,
                -0.42499586408779966, -0.10312365402934934, -0.4086213846053524, -0.37276028428770525,
                -0.35483046814192504, -0.3597226616281258, -0.5021470745846376, 2.1611314905000607, 0.271963521523168,
                -0.7404931339590394],
               [7.262504796617252, -0.5661092684333765, -0.39340053216072673, -0.6138186756289147, -0.43550723995555546,
                -0.40620189391027217, -0.19988828935528796, -0.48033708637986544, -0.3586898547343785,
                -0.8557013919612129, -0.2702817000151907, -0.305379996343186, -0.49306811088847924, -0.7897895121312639,
                -0.3097033862034313, -0.29824866434043834, -0.28968101925483886, -0.5862580826148391,
                -0.6093298346364545, -0.30962027986767315, -0.4299119899730648, -0.2381724058688124,
                -0.4203898934934835, -0.3701113069177264, -0.3566879421903069, -0.3628544235751895, -0.5048799333500822,
                -0.3878800897601518, -0.2989204054267255, -0.8277880199942323],
               [-0.2993691895895033, -0.5232504988950298, 3.4858494632262804, -0.19136757228861623,
                -0.43233536519108967, -0.40559200999304584, -0.01899076967931028, -0.4364503008889999,
                -0.21198224896595577, -0.20877729852578342, -0.18483939518033435, -0.23377831195718982,
                -0.48333667720835666, 0.17303509578116724, -0.32352512481877654, -0.3038212459086975,
                -0.28967236081921055, -0.602452286529233, 1.2054684531969257, -0.29585831359621084, -0.40554745715671,
                -0.25944152505345813, -0.28490322324819395, -0.35874383258377507, -0.34302840370272125,
                -0.3604174009736897, -0.4918329215570437, -0.39353687722089653, -0.31070674325841796,
                0.14917840377297834],
               [0.25446582117113464, 0.3062529679074819, 1.0349768081294848, 1.5238958935779363, 0.23554215961322456,
                -0.38861105299124044, -0.19841767281819758, -0.41797442873632124, -0.3324717315987074,
                1.5230954161740047, -0.2519065011043261, -0.28169242636613145, -0.18457606002172364, 1.0295128420327548,
                -0.2552200070880078, -0.2950053416489576, -0.28109592346727524, -0.1440716948324099,
                -0.5634882015132475, -0.030327117627334338, -0.3932649207861159, -0.08357810485445089,
                -0.363980194443997, -0.33056601005692005, -0.33294052727859785, -0.35851909525723724,
                -0.13123937856605067, 2.620097823404514, -0.3150228002265553, -0.6755974359720314],
               [-0.29991459062654113, -0.36144401132201015, -0.25435852904690054, -0.3788363582487152,
                -0.4321618458425756, -0.4036876473722134, 0.018350254365592726, -0.16220723981553686,
                -0.08814989259075467, 0.17653122469921037, -0.26055391096151503, 4.089184605722292, -0.4591100136307543,
                0.4779178773306086, -0.3281185100332766, -0.3037983336387861, -0.2896179569692496, -0.6229182132461776,
                0.8243645948344422, -0.10046839836404313, -0.41135374202949915, -0.2609234537764395, 0.5526054708006096,
                -0.36872920465546266, -0.3373689846921031, -0.25394626352204586, -0.434527297282532,
                -0.3935309289640236, -0.31161142017566684, -0.13344363356334052],
               [3.519771925032144, 3.9391453894459296, -0.34484322075279933, -0.2632428441890393, -0.1446735021211589,
                -0.4049757834073341, -0.1796188781590183, -0.4684534613858089, -0.25101435588995696,
                -0.6461902181621425, -0.2658103196492338, -0.299057158984199, -0.4131996504285702, -0.4430293996627698,
                -0.28481524505025874, -0.30142147693387994, -0.28500429151833717, -0.39231691221455334,
                -0.6067627787269727, 0.30461623203591315, -0.4278194842655562, -0.22735846922765512,
                -0.4014013477456485, 0.33529131760288156, -0.3487645386851687, -0.36269692674046045,
                -0.20294112658442282, -0.28577580145534737, -0.3166105389670329, -0.7927038449913679],
               [-0.29850675242311264, -0.5653931368706236, -0.39559642877174805, -0.6137759021558201,
                -0.43453279076897255, -0.3767422962444827, -0.20143800041916013, -0.3156416042364652,
                -0.358489736825828, -0.8317506941996737, -0.2701091303810681, -0.30466079254247586, -0.5029226652365805,
                -0.7601308110131373, -0.319643658960099, -0.3002978700374487, -0.2893975457625132, -0.6470702254768984,
                -0.5966945889340297, -0.31080274423570997, -0.4162006680770152, -0.2654628946006831,
                -0.42133039844296166, -0.3735774643789941, -0.3035666720411819, 5.544566491377071, -0.5023209160371958,
                -0.39049113636482824, -0.3177270833021376, -0.810066930949618],
               [0.4095509147055913, 1.7020643541321518, 0.15554763864655266, 3.5484139617856556, 0.966302894381439,
                -0.4026020439776203, -0.20015153511742617, -0.46619506708315694, -0.3499700787794773,
                0.29148279533287097, -0.2572470163954394, -0.28583024601289025, 0.09540183366526818, 0.5390372138685945,
                -0.2683980357060881, -0.30092700720563886, -0.277857097237263, 0.6252244645107096, -0.5807137448490135,
                0.17989770448116832, -0.4136890899731732, -0.034572520771654944, -0.3092132342073879,
                -0.35478915234228187, -0.34783521874985573, -0.36226293787958297, 1.277495812292069, 0.9073131282453756,
                -0.3125864368278612, -0.6783245232671027],
               [-0.27668704700956637, -0.5142427472327655, -0.39445361704703974, -0.6012680373781876,
                -0.4268138625914527, -0.40603550362022534, 9.749272341420834, -0.4793455095735126, -0.13369130905029897,
                -0.8489915228468335, -0.2733329488111624, -0.30464620346730886, -0.4941345829395063,
                -0.7746000858270174, -0.32702059575960385, -0.3032004501936388, -0.2884597914775645,
                -0.6312794593482909, -0.6126462260080899, -0.29862585286954285, -0.4316663968836764,
                -0.2640016131122302, -0.419565961248419, 0.10769289980594256, -0.35647100918215424, -0.3630399466143982,
                -0.4768971236278024, -0.389940075418853, -0.31515000679965083, -0.8329126042340206],
               [-0.3000250012713713, -0.5127817405303768, -0.39387332682693793, -0.6106546646543749,
                -0.31257971944356344, 0.7423300968166215, -0.18452904351663674, -0.47192000144252444,
                -0.3523495250031923, -0.7926080921559395, -0.0811256790777675, -0.29876137744215064,
                -0.24943531046479503, -0.7453179402325685, -0.3308501063111789, -0.28572074959114924, 1.425571936472301,
                -0.6365853178906871, -0.6010679081933707, -0.3096956835428703, -0.4317547801181182,
                -0.26800277573197434, -0.4142347227717366, -0.3598024977562091, -0.25934419599565683,
                -0.3123211074821794, 3.4974975687028405, 4.189557708616585, -0.31209702950102475, -0.7649969288927099],
               [-0.25016168426847457, -0.33825490292213034, -0.35091387543649666, -0.4207453789889647,
                -0.3840045934801711, -0.3283927535946778, -0.19512238612187402, 0.47290683247597626,
                -0.25480036190981975, 0.7914724376728779, 0.9076789655130287, -0.16022476928726548,
                -0.32431159834536494, -0.2652273798336293, 0.10194724314143609, 0.7278036163073792,
                -0.10509809933945329, 0.15960540129298437, 0.37025478639783266, -0.24789251016130176,
                -0.30218572186900433, -0.12363417367026497, -0.28548415899220797, -0.31952943749049173,
                0.1975864859585503, -0.29699553910390475, 0.08540805513572182, -0.2614402684594544, 2.14752555022822,
                0.8313565207389402],
               [-0.2939877557833498, -0.5588801115741266, -0.38941512357013675, -0.5881400431597779,
                -0.4298384430885003, -0.3181686676446124, -0.18795690213354166, -0.46992281495879945,
                -0.3538851794523505, -0.8020930473575183, -0.0392089483520965, -0.3032302409148214,
                -0.46434958174321855, -0.7344054014243214, -0.05047008403192809, -0.23550037221094702,
                6.467002711976119, -0.3299847225542447, -0.5845012619271609, -0.31022442431449976, -0.3417369663192466,
                -0.25360481068383584, -0.40322752105793375, 0.008459672082844684, -0.35224072185002797,
                -0.36253820589637725, -0.49029424390730936, 0.032554348140750825, -0.30490418223631116,
                -0.7642657322486072]]

    y_train = ['palmar', 'dorsal', 'dorsal', 'dorsal', 'dorsal', 'palmar', 'dorsal', 'palmar', 'palmar', 'palmar', 'palmar',
     'palmar', 'dorsal', 'dorsal', 'dorsal', 'dorsal', 'palmar', 'dorsal', 'palmar', 'palmar', 'palmar', 'dorsal',
     'dorsal', 'palmar', 'palmar', 'palmar', 'palmar', 'dorsal', 'palmar', 'dorsal', 'dorsal', 'dorsal', 'dorsal',
     'palmar', 'dorsal', 'palmar']

    query_image = [[0.01135152, 0.00861706, 0.04576377, 0.01141918, 0.00486584,
                    0.004486, 0.01618593, 0.02450214, 0.00499952, 0.00361814,
                    0.0045519, 0.01192001, 0.17113698, 0.01032455, 0.20466253,
                    0.00513739, 0.03763625, 0.04199035, 0.01473354, 0.0673981,
                    0.02722416, 0.15068656, 0.00271998, 0.00791481, 0.04980393,
                    0.01110106, 0.00939503, 0.009814, 0.00382016, 0.02221962]]


    x_train_dt =   [[-0.3000250012713713, -0.5127817405303768, -0.39387332682693793, -0.6106546646543749,
                -0.31257971944356344, 0.7423300968166215, -0.18452904351663674, -0.47192000144252444,
                -0.3523495250031923, -0.7926080921559395, -0.0811256790777675, -0.29876137744215064,
                -0.24943531046479503, -0.7453179402325685, -0.3308501063111789, -0.28572074959114924, 1.425571936472301,
                -0.6365853178906871, -0.6010679081933707, -0.3096956835428703, -0.4317547801181182,
                -0.26800277573197434, -0.4142347227717366, -0.3598024977562091, -0.25934419599565683,
                -0.3123211074821794, 3.4974975687028405, 4.189557708616585, -0.31209702950102475, -0.7649969288927099],
               [-0.25016168426847457, -0.33825490292213034, -0.35091387543649666, -0.4207453789889647,
                -0.3840045934801711, -0.3283927535946778, -0.19512238612187402, 0.47290683247597626,
                -0.25480036190981975, 0.7914724376728779, 0.9076789655130287, -0.16022476928726548,
                -0.32431159834536494, -0.2652273798336293, 0.10194724314143609, 0.7278036163073792,
                -0.10509809933945329, 0.15960540129298437, 0.37025478639783266, -0.24789251016130176,
                -0.30218572186900433, -0.12363417367026497, -0.28548415899220797, -0.31952943749049173,
                0.1975864859585503, -0.29699553910390475, 0.08540805513572182, -0.2614402684594544, 2.14752555022822,
                0.8313565207389402],
               [-0.2939877557833498, -0.5588801115741266, -0.38941512357013675, -0.5881400431597779,
                -0.4298384430885003, -0.3181686676446124, -0.18795690213354166, -0.46992281495879945,
                -0.3538851794523505, -0.8020930473575183, -0.0392089483520965, -0.3032302409148214,
                -0.46434958174321855, -0.7344054014243214, -0.05047008403192809, -0.23550037221094702,
                6.467002711976119, -0.3299847225542447, -0.5845012619271609, -0.31022442431449976, -0.3417369663192466,
                -0.25360481068383584, -0.40322752105793375, 0.008459672082844684, -0.35224072185002797,
                -0.36253820589637725, -0.49029424390730936, 0.032554348140750825, -0.30490418223631116,
                -0.7642657322486072]]
    y_train_dt = [1,-1,-1]

    # relavant = []
    # x_train_dt = []
    # for i in range(len(neighbours[0])):
    #     index = neighbours[0][i]
    #     print(index)
    #     x_train_dt.append(x_train[index])
    #     rel = input("Relevant/Irrelevant?")
    #     relavant.append(rel)
    # inp = input("Do you want to continue? ")
    # if inp == "n":
    #     break

    #x_train_dt = 14
    #x_train_knn = 20
    dt = DecisionTreeClassifier()
    dt.fit(x_train_dt, y_train_dt)
    predictions = dt.predict(x_train)
    indices = [i for i, x in enumerate(predictions) if x == 1]
    x_train_knn = []
    y_train_knn = []
    for i in indices:
        x_train_knn.append(x_train[i])
        y_train_knn.append(y_train[i])
    knn = KNeighborsClassifier(n_neighbors=3)
    knn.fit(x_train_knn, y_train_knn)
    neighbours = knn.kneighbors(X=query_image, n_neighbors=20, return_distance=False)
    lsh_similar_images = []
    rel_similar_images = [lsh_similar_images[i] for i in neighbours]
    rel_similar_images = ['Hand_0000072.jpg', 'Hand_0000073.jpg', 'Hand_0000074.jpg', 'Hand_0000112.jpg']
    return rel_similar_images


def get_training_set():
    x_train = []
    y_train = []
    for i in range(similar_images_g):
        for j in range(feedback_imgs_g):
            if similar_images_g[i] == feedback_imgs_g[j]:
                x_train.append(similar_image_vectors_g[i])
                y_train.append(feedback_vals_g[j])
    return x_train, y_train


similar_images_g = []
similar_image_vectors_g = []
feedback_imgs_g = []
feedback_vals_g = []


def main():
    query_image = "Hand_0000072.jpg"
    # results = search_LSH(query_image)
    results = ['Hand_0000072.jpg', 'Hand_0000073.jpg', 'Hand_0000074.jpg', 'Hand_0000112.jpg']
    global similar_images_g, similar_image_vectors_g
    # similar_images_g = list(i['imageId'] for i in results)
    # similar_image_vectors_g = list(i['reducedDimensions'] for i in results)

    similar_images_g = results

    # rewrite_query(None)
    relevancefeedback.relevance_fdbk(os.path.abspath("Hands"), "DT", query_image, similar_images_g)
    pass


if __name__ == "__main__":
    main()
